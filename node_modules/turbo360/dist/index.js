var superagent=require("superagent"),Promise=require("bluebird"),StripeUtils=require("./utils/StripeUtils"),Auth=require("./utils/Auth"),IndexDB=require("./utils/IndexDB"),Microservice=function(e){const r="https://velocity-microservices.herokuapp.com";var i={site_id:e.site_id,base_url:r},t=function(e,t){return null==t&&(t={}),t.site=i.site_id,new Promise(function(i,o){return null==t.site?void o(new Error("Please Set Your TURBO_APP_ID")):0==t.site.length?void o(new Error("Please Set Your TURBO_APP_ID")):void superagent.get(r+"/api/"+e.toLowerCase()).query(t).set("Accept","application/json").end(function(e,r){if(e)return void o(e);if("fail"==r.body.confirmation)return void o(new Error(r.body.message));var t=r.body.results;i(t)})})},o=function(e,t){return new Promise(function(o,n){return null==i.site_id?void n(new Error("Please Set Your TURBO_APP_ID")):i.site_id.length<20?void n(new Error("Please Set Your TURBO_APP_ID")):void superagent.get(r+"/api/"+e.toLowerCase()+"/"+t).query(null).set("Accept","application/json").end(function(e,r){if(e)return void n(e);if("fail"==r.body.confirmation)return void n(new Error(r.body.message));var i=r.body.result;o(i)})})},n=function(e,t){return new Promise(function(o,n){return null==i.site_id?void n(new Error("Please Set Your TURBO_APP_ID")):i.site_id.length<20?void n(new Error("Please Set Your TURBO_APP_ID")):null==t?void n(new Error("Post parameters required.")):(t.site=i.site_id,void superagent.post(r+"/api/"+e.toLowerCase()).send(t).set("Accept","application/json").end(function(e,r){if(e)return void n(e);if("fail"==r.body.confirmation)return void n(new Error(r.body.message));var i=r.body.result||r.body.results;o(i)}))})},s=function(e,t,o){return new Promise(function(n,s){return null==i.site_id?void s(new Error("Please Set Your TURBO_APP_ID")):i.site_id.length<20?void s(new Error("Please Set Your TURBO_APP_ID")):null==o?void s(new Error("Post parameters required.")):(Object.keys(o).forEach(function(e,r){var i=o[e];t[e]=i}),void superagent.put(r+"/api/"+e.toLowerCase()+"/"+t.id).send(t).set("Accept","application/json").end(function(e,r){if(e)return void s(e);if("fail"==r.body.confirmation)return void s(new Error(r.body.message));var i=r.body.result||r.body.results;n(i)}))})},u=function(e,t){return new Promise(function(o,n){return null==i.site_id?void n(new Error("Please Set Your TURBO_APP_ID")):i.site_id.length<20?void n(new Error("Please Set Your TURBO_APP_ID")):void superagent.delete(r+"/api/"+e+"/"+t.id).set("Accept","application/json").end(function(e,r){if(e)return void n(e);if("fail"==r.body.confirmation)return void n(new Error(r.body.message));var i=r.body.result||r.body.results;o(i)})})},d=function(e){return new Promise(function(t,o){return null==i.site_id?void o(new Error("Please Set Your TURBO_APP_ID")):i.site_id.length<20?void o(new Error("Please Set Your TURBO_APP_ID")):null==e?void o(new Error("Post parameters required.")):(e.site=i.site_id,void superagent.post(r+"/email/send").send(e).set("Accept","application/json").end(function(e,r){return e?void o(e):"fail"==r.body.confirmation?void o(new Error(r.body.message)):void t(r.body.result)}))})},a=StripeUtils(),l=Auth(i);return{fetch:t,fetchOne:o,create:n,update:s,remove:u,sendEmail:d,login:l.login,currentUser:l.currentUser,createStripeCharge:a.createStripeCharge,createStripeAccount:a.createStripeAccount,recurringCharge:a.recurringCharge}};module.exports=Microservice;